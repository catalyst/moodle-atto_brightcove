YUI.add("moodle-atto_brightcove-button",function(e,t){var n="atto_brightcove",r="brightcove-video",i={BUTTON:"atto_brightcove_submit",BUTTON_SELECT:"atto_brightcove_select",FORM:"atto_brightcove_form",VIDEOID:"videoid",WIDTH:"width",HEIGHT:"height"},s={FORM:".atto_brightcove_form",SUBMIT:".atto_brightcove_submit",SELECT:".atto_brightcove_select",VIDEOID:".videoid",WIDTH:".width",HEIGHT:".height"},o='<form class="atto_form {{CSS.FORM}}"><label for="{{CSS.VIDEOID}}">{{get_string "videoid" component}}</label><input class="{{CSS.VIDEOID}}" id="{{CSS.VIDEOID}}" name="{{CSS.VIDEOID}}" /><button class="{{CSS.BUTTON_SELECT}}" name="{{CSS.BUTTON_SELECT}}" type="button">{{get_string "select" component}}</button><label for="{{CSS.WIDTH}}">{{get_string "width" component}}</label><input class="{{CSS.WIDTH}}" id="{{CSS.WIDTH}}" name="{{CSS.WIDTH}}" /><label for="{{CSS.HEIGHT}}">{{get_string "height" component}}</label><input class="{{CSS.HEIGHT}}" id="{{CSS.HEIGHT}}" name="{{CSS.HEIGHT}}" /><br /><br /><button class="{{CSS.BUTTON}}">{{get_string "insert" component}}</button></form>';e.namespace("M.atto_brightcove").Button=e.Base.create("button",e.M.editor_atto.EditorPlugin,[],{_currentSelection:null,initializer:function(e){if(e.disabled)return;this.editor.delegate("click",this._handleClick,"brightcove-video",this),this.editor.delegate("dblclick",this._displayDialogue,"brightcove-video",this),this.addButton({icon:"icon",iconComponent:"atto_brightcove",tags:r,tagMatchRequiresAll:!1,callback:this._displayDialogue})},_handleClick:function(e){var t=e.target,n=this.get("host").getSelectionFromNode(t);this.get("host").getSelection()!==n&&this.get("host").setSelection(n)},_displayDialogue:function(e){this._currentSelection=this.get("host").getSelection();var t=this.getDialogue({headerContent:M.util.get_string("insertvideo",n,null),focusAfterHide:!0},!0);t.set("bodyContent",this._getDialogueContent()),this._setSelectedData(),t.show()},_setSelectedData:function(){var t=this.get("host").getSelectionParentNode(),n,r,i,o;if(!t)return;n=this._findSelectedVideo(e.one(t)),n&&(r=n.getAttribute("video-id"),i=n.getAttribute("width"),o=n.getAttribute("height"),r&&this._content.one(s.VIDEOID).setAttribute("value",r),i&&this._content.one(s.WIDTH).setAttribute("value",i),o&&this._content.one(s.HEIGHT).setAttribute("value",o))},_findSelectedVideo:function(e){var t=e.get("tagName"),n,i;return t&&t.toLowerCase()===r?e:(i=[],e.all(r).each(function(e){!n&&this.get("host").selectionContainsNode(e)&&i.push(e)},this),i.length>0?i[0]:(n=e.ancestor(r),n?n:null))},_getDialogueContent:function(){var t=e.Handlebars.compile(o);return this._content=e.Node.create(t({CSS:i,SELECTORS:s,component:n})),this._content.one(s.SUBMIT).on("click",this._insertVideo,this),this._content},_insertVideo:function(e){e.preventDefault(),this.getDialogue({focusAfterHide:null}).hide();var t=e.currentTarget.ancestor(s.FORM).one(s.VIDEOID).get("value"),n=e.currentTarget.ancestor(s.FORM).one(s.WIDTH).get("value"),i=e.currentTarget.ancestor(s.FORM).one(s.HEIGHT).get("value");this.get("host").setSelection(this._currentSelection);var o="<"+r+' video-id="'+t+'"';n&&(o=o.concat(' width="'+n+'"')),i&&(o=o.concat(' height="'+i+'"')),o=o.concat("></"+r+">"),this.editor.focus(),this.get("host").insertContentAtFocusPoint(o),this.markUpdated()},_selectVideoDialog:function(e){e.preventDefault(),alert("This feature is not implemented yet")}})},"@VERSION@",{requires:["moodle-editor_atto-plugin"]});
